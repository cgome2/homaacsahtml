"use strict";(self.webpackChunkfury=self.webpackChunkfury||[]).push([[3370],{14499:(g,p,i)=>{i.d(p,{X:()=>s});var l=i(41777);const s=(0,l.X$)("fadeInUp",[(0,l.eR)(":enter",[(0,l.oB)({transform:"translateY(3vh)",opacity:0}),(0,l.jt)("400ms cubic-bezier(0.35, 0, 0.25, 1)",(0,l.oB)({transform:"translateY(0)",opacity:1}))])])},43370:(g,p,i)=>{i.r(p),i.d(p,{LoginModule:()=>j});var l=i(69808),s=i(93075),_=i(7057),d=i(3299),f=i(70655),v=i(14499);function h(){return o=>{const n=o.controls.new_password,e=o.controls.confirm_new_password;new RegExp(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/).test(n.value)?n.setErrors(null):n.setErrors({weakPassword:"Al menos 8 caracteres y al menos: 1 n\xfamero, 1 may\xfascula, 1 min\xfascula y un caracter especial"}),e.setErrors(n.value===e.value||""===e.value&&""===n.value?null:{differentPasswords:"Los passwords no coincideen"})}}var x=i(84872),b=i(98545),t=i(5e3),w=i(57261),C=i(88338),Z=i(33344),T=i(551),k=i(92660),m=i(30277),u=i(67322),A=i(77531),L=i(77446),y=i(47423),U=i(25245);function I(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Necesita un usuario para acceder"),t.qZA())}function q(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return a.hide=!a.hide}),t.TgZ(1,"mat-icon"),t._uU(2),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.uIk("aria-label","Hide password")("aria-pressed",e.hide),t.xp6(2),t.Oqu(e.hide?"visibility_off":"visibility")}}function N(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Necesita una contrase\xf1a para acceder"),t.qZA())}function F(o,n){if(1&o&&(t.TgZ(0,"mat-error"),t._uU(1),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Oqu(e.form.get("new_password").errors.weakPassword)}}function P(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"mat-form-field",21),t.TgZ(1,"mat-label"),t._uU(2,"Password:"),t.qZA(),t._UZ(3,"input",22),t.TgZ(4,"button",20),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return a.hide1=!a.hide1}),t.TgZ(5,"mat-icon"),t._uU(6),t.qZA(),t.qZA(),t.TgZ(7,"mat-hint"),t._uU(8,"Oprima el \xedcono del ojo para hacer visible la contrase\xf1a"),t.qZA(),t.YNc(9,F,2,1,"mat-error",9),t.qZA()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("type",e.hide1?"password":"text"),t.xp6(1),t.uIk("aria-label","Hide password")("aria-pressed",e.hide1),t.xp6(2),t.Oqu(e.hide1?"visibility_off":"visibility"),t.xp6(3),t.Q6J("ngIf",e.form.get("new_password").errors)}}function J(o,n){if(1&o&&(t.TgZ(0,"mat-error"),t._uU(1),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Oqu(e.form.get("confirm_new_password").errors.differentPasswords)}}function M(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"mat-form-field",21),t.TgZ(1,"mat-label"),t._uU(2,"Confirmar password:"),t.qZA(),t._UZ(3,"input",23),t.TgZ(4,"button",20),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return a.hide2=!a.hide2}),t.TgZ(5,"mat-icon"),t._uU(6),t.qZA(),t.qZA(),t.TgZ(7,"mat-hint"),t._uU(8,"Oprima el \xedcono del ojo para hacer visible la contrase\xf1a"),t.qZA(),t.YNc(9,J,2,1,"mat-error",9),t.qZA()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("type",e.hide2?"password":"text"),t.xp6(1),t.uIk("aria-label","Hide password")("aria-pressed",e.hide2),t.xp6(2),t.Oqu(e.hide2?"visibility_off":"visibility"),t.xp6(3),t.Q6J("ngIf",e.form.get("confirm_new_password").errors)}}function S(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Necesita un c\xf3digo de verificaci\xf3n para acceder"),t.qZA())}function O(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"mat-form-field",24),t.TgZ(1,"mat-label"),t._uU(2,"C\xf3digo de verificaci\xf3n"),t.qZA(),t._UZ(3,"input",25),t.TgZ(4,"button",20),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return a.hide3=!a.hide3}),t.TgZ(5,"mat-icon"),t._uU(6),t.qZA(),t.qZA(),t.TgZ(7,"mat-hint"),t._uU(8,"Oprima el \xedcono del ojo para hacer visible el c\xf3digo"),t.qZA(),t.YNc(9,S,2,0,"mat-error",9),t.qZA()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("type",e.hide3?"password":"text"),t.xp6(1),t.uIk("aria-label","Hide password")("aria-pressed",e.hide3),t.xp6(2),t.Oqu(e.hide3?"visibility_off":"visibility"),t.xp6(3),t.Q6J("ngIf",e.form.get("verification_code").hasError("required"))}}function E(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",6),t.TgZ(1,"div",26),t._UZ(2,"img",27),t.qZA(),t.TgZ(3,"mat-form-field",24),t.TgZ(4,"mat-label"),t._uU(5,"Capture el c\xf3digo captcha"),t.qZA(),t._UZ(6,"input",28),t.TgZ(7,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw().getNewCaptcha()}),t.TgZ(8,"mat-icon"),t._uU(9,"refresh"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(2),t.Q6J("src",e.captcha_url,t.LSH)}}function Q(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw().sendWithCaptcha()}),t._uU(1,"AUTENTICAR"),t.qZA()}}function Y(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw().activateUser()}),t._uU(1,"ACTIVAR USUARIO"),t.qZA()}}function V(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw().sendWithoutVerificationCode()}),t._uU(1,"AUTENTICAR"),t.qZA()}}function H(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw().sendWithVerificationCode()}),t._uU(1,"INGRESAR"),t.qZA()}}function R(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw().activateUser()}),t._uU(1,"ACTIVAR USUARIO"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("disabled",e.form.invalid)}}const W=function(){return["/forgot-password"]},z=[{path:"",component:(()=>{class o{constructor(e,r,a,c,D,G,X,$){this.router=e,this.route=r,this.fb=a,this.snackbar=c,this._authService=D,this._tokenStorage=G,this._sidenavService=X,this._profilesService=$,this.isLoggedIn=!1,this.isLoginFailed=!1,this.errorMessage="",this.roles=[],this.verificationCode=!1,this.createPassword=!1,this.captcha=!1,this.captcha_token="",this.captcha_url="",this.general_settings=null,this.form=new s.cw({}),this.hide=!0,this.hide1=!0,this.hide2=!0,this.hide3=!0}ngOnInit(){this.captcha="1"===this.route.snapshot.data.settings.two_stage_verification_captcha,this.captcha?this.getNewCaptcha():this.captcha=!1,this._sidenavService.clearItems(),this.form=this.fb.group({username:["",s.kI.required],password:["",s.kI.required],verification_code:[""],new_password:[""],confirm_new_password:[""],captcha:["",s.kI.required]})}sendWithVerificationCode(){this._authService.loginCode(this.form.controls.username.value,this.form.controls.password.value,this.form.controls.verification_code.value).subscribe(c=>{this._tokenStorage.saveToken(c.token),this._tokenStorage.saveUser(c),this.isLoginFailed=!1,this.isLoggedIn=!0,this.roles=this._tokenStorage.getUser().roles,this.reloadPage()},c=>{this.snackbar.open(c.error.message,null,{duration:1e4,panelClass:["red-snackbar"]}),this.errorMessage=c.message,this.isLoginFailed=!0})}login(){this.captcha?this.sendWithCaptcha():this.verificationCode||this.createPassword||this.captcha?!this.verificationCode||this.createPassword||this.captcha?!this.verificationCode&&this.createPassword&&!this.captcha&&this.activateUser():this.sendWithVerificationCode():this.sendWithoutVerificationCode()}sendWithCaptcha(){return(0,f.mG)(this,void 0,void 0,function*(){this._authService.loginCaptcha(this.form.controls.username.value,this.form.controls.password.value,this.form.controls.captcha.value,this.captcha_token).subscribe(c=>{"rc5"===c.code?(this.createPassword=!0,this.form.controls.username.disable(),this.form.controls.password.disable(),this.form.controls.new_password.setValidators([s.kI.required]),this.form.controls.confirm_new_password.setValidators([s.kI.required]),this.form.setValidators(h()),this.snackbar.open(c.message,null,{duration:1e4,panelClass:["green-snackbar"]})):(this._tokenStorage.saveToken(c.token),this._tokenStorage.saveUser(c),this.isLoginFailed=!1,this.isLoggedIn=!0,this.roles=this._tokenStorage.getUser().roles,this.reloadPage())},c=>{this.snackbar.open(c.error.message,null,{duration:1e4,panelClass:["red-snackbar"]}),this.errorMessage=c.message,this.isLoginFailed=!0,this.getNewCaptcha()})})}sendWithoutVerificationCode(){this._authService.loginNoCode(this.form.controls.username.value,this.form.controls.password.value).subscribe(a=>{"rc0"===a.code?(this.verificationCode=!0,this.createPassword=!1,this.form.clearValidators(),this.snackbar.open(a.message,null,{duration:1e4,panelClass:["green-snackbar"]})):"rc5"===a.code&&(this.createPassword=!0,this.verificationCode=!1,this.form.controls.username.disable(),this.form.controls.password.disable(),this.form.controls.new_password.setValidators([s.kI.required]),this.form.controls.confirm_new_password.setValidators([s.kI.required]),this.form.setValidators(h()),this.snackbar.open(a.message,null,{duration:1e4,panelClass:["green-snackbar"]}))},a=>{this.snackbar.open(a.error.message,null,{duration:1e4,panelClass:["red-snackbar"]}),this.errorMessage=a.message,this.isLoginFailed=!0})}activateUser(){var e=new x.n;e.user=this.form.controls.username.value,e.previous_password=this.form.controls.password.value,e.password=this.form.controls.new_password.value,e.status=2,e.require_change_password=0,this._authService.userInGoodStanding(e).subscribe(r=>{"rc6"===r.code&&(this.verificationCode=!1,this.createPassword=!1,this.form.controls.username.enable(),this.form.controls.password.enable(),this.form.controls.password.reset(),this.form.clearValidators(),this.form.controls.new_password.clearValidators(),this.form.controls.confirm_new_password.clearValidators(),this.snackbar.open(r.message,null,{duration:1e4,panelClass:["green-snackbar"]}))},r=>{this.snackbar.open(r.error.message,null,{duration:1e4,panelClass:["red-snackbar"]}),this.errorMessage=r.message,this.isLoginFailed=!0})}reloadPage(){return(0,f.mG)(this,void 0,void 0,function*(){var e=this._tokenStorage.getUser();yield this._profilesService.getProfile(e.profile_id).toPromise().then(r=>{this._sidenavService.addItems(r.sidenav_items)}).catch(r=>{this._sidenavService.clearItems(),alert("No hay conexi\xf3n con el servidor no puede cargarse el formulario"+r)}),this.router.navigate(["/dashboards/global"])})}getNewCaptcha(){this._authService.getCaptcha().subscribe(e=>{this.captcha_token=e.captcha_token,this.captcha_url=b._.settings.apiServer.API_URL_BASE+"/captcha/"+this.captcha_token+".png"},e=>{this.snackbar.open(e.error,null,{duration:1e4,panelClass:["red-snackbar"]})})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(d.F0),t.Y36(d.gz),t.Y36(s.qu),t.Y36(w.ux),t.Y36(C.e),t.Y36(Z.i),t.Y36(T.Z),t.Y36(k.L))},o.\u0275cmp=t.Xpm({type:o,selectors:[["fury-login"]],decls:38,vars:17,consts:[["fxLayout","column","fxLayoutAlign","center center",1,"page","background-pattern",3,"keyup.enter"],[1,"card","border-radius","elevation"],["fxLayout","column","fxLayoutAlign","center center",1,"header","padding","background-primary"],["src","../../../../assets/img/maacsa.png","alt","Logo",1,"img"],[1,"title"],["fxLayout","column","fxLayoutGap","16px",1,"padding",3,"formGroup"],["fxFlex","auto","fxLayout","column"],["fxFlex","grow","appearance","outline"],["matInput","","required","","formControlName","username"],[4,"ngIf"],["matInput","","formControlName","password",3,"type"],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["appearance","outline","fxFlex","auto",4,"ngIf"],["appearance","outline","fxFlex","grow",4,"ngIf"],["fxFlex","auto","fxLayout","column",4,"ngIf"],["fxLayout","row","fxLayoutAlign","space-between center"],[1,"caption"],[1,"caption",3,"routerLink"],["type","button","style","background-color: rgba(18,34,55,1);","color","primary","mat-raised-button","",3,"click",4,"ngIf"],["type","button","style","background-color: rgba(18,34,55,1);","color","primary","mat-raised-button","",3,"disabled","click",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"click"],["appearance","outline","fxFlex","auto"],["matInput","","formControlName","new_password",3,"type"],["matInput","","formControlName","confirm_new_password",3,"type"],["appearance","outline","fxFlex","grow"],["matInput","","formControlName","verification_code",2,"font-size","20px",3,"type"],["fxLayout","row",2,"padding","0px 0px 20px 0px"],[1,"captcha",3,"src"],["matInput","","type","text","formControlName","captcha",2,"font-size","20px"],["type","button","color","primary","mat-raised-button","",2,"background-color","rgba(18,34,55,1)",3,"click"],["type","button","color","primary","mat-raised-button","",2,"background-color","rgba(18,34,55,1)",3,"disabled","click"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0),t.NdJ("keyup.enter",function(){return r.login()}),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"div"),t._UZ(4,"img",3),t._UZ(5,"br"),t._UZ(6,"br"),t.TgZ(7,"spam",4),t._uU(8,"HOMaacSA"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",5),t.TgZ(10,"div",6),t.TgZ(11,"mat-form-field",7),t.TgZ(12,"mat-label"),t._uU(13,"Usuario"),t.qZA(),t._UZ(14,"input",8),t.YNc(15,I,2,0,"mat-error",9),t.qZA(),t.TgZ(16,"mat-form-field",7),t.TgZ(17,"mat-label"),t._uU(18,"Contrase\xf1a:"),t.qZA(),t._UZ(19,"input",10),t.YNc(20,q,3,3,"button",11),t.TgZ(21,"mat-hint"),t._uU(22,"Oprima el \xedcono del ojo para hacer visible la contrase\xf1a"),t.qZA(),t.YNc(23,N,2,0,"mat-error",9),t.qZA(),t.YNc(24,P,10,5,"mat-form-field",12),t.YNc(25,M,10,5,"mat-form-field",12),t.YNc(26,O,10,5,"mat-form-field",13),t.qZA(),t.YNc(27,E,10,1,"div",14),t.TgZ(28,"div",15),t.TgZ(29,"mat-checkbox",16),t._uU(30,"Recordarme"),t.qZA(),t.TgZ(31,"a",17),t._uU(32,"\xbfOlvid\xf3 su contrase\xf1a?"),t.qZA(),t.qZA(),t.YNc(33,Q,2,0,"button",18),t.YNc(34,Y,2,0,"button",18),t.YNc(35,V,2,0,"button",18),t.YNc(36,H,2,0,"button",18),t.YNc(37,R,2,1,"button",19),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(1),t.Q6J("@fadeInUp",void 0),t.xp6(8),t.Q6J("formGroup",r.form),t.xp6(6),t.Q6J("ngIf",r.form.get("username").hasError("required")),t.xp6(4),t.Q6J("type",r.hide?"password":"text"),t.xp6(1),t.Q6J("ngIf",!r.createPassword),t.xp6(3),t.Q6J("ngIf",r.form.get("password").hasError("required")),t.xp6(1),t.Q6J("ngIf",r.createPassword),t.xp6(1),t.Q6J("ngIf",r.createPassword),t.xp6(1),t.Q6J("ngIf",r.verificationCode),t.xp6(1),t.Q6J("ngIf",r.captcha),t.xp6(4),t.Q6J("routerLink",t.DdM(16,W)),t.xp6(2),t.Q6J("ngIf",r.captcha&&!r.createPassword),t.xp6(1),t.Q6J("ngIf",r.captcha&&r.createPassword),t.xp6(1),t.Q6J("ngIf",!r.verificationCode&&!r.createPassword&&!r.captcha),t.xp6(1),t.Q6J("ngIf",r.verificationCode&&!r.createPassword&&!r.captcha),t.xp6(1),t.Q6J("ngIf",r.createPassword&&!r.verificationCode&&!r.captcha))},directives:[m.xw,m.Wh,m.SQ,s.JL,s.sg,m.yH,u.KE,u.hX,A.Nt,s.Fj,s.Q7,s.JJ,s.u,l.O5,u.bx,L.oG,d.yS,u.TO,y.lW,u.R9,U.Hw],styles:[".page[_ngcontent-%COMP%]{display:block;height:100%;width:100%}.card[_ngcontent-%COMP%]{width:380px}@media screen and (max-width: 599px){.card[_ngcontent-%COMP%]{width:300px}}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:#122237;border-top-left-radius:8px;border-top-right-radius:8px}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .img[_ngcontent-%COMP%]{width:100%}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#fff;font-size:25px;font-weight:700;margin-left:185px}.captcha[_ngcontent-%COMP%]{max-width:-moz-available;border-radius:5px;border-style:solid;border-color:#d3d3d3;border-width:thin}.logo[_ngcontent-%COMP%]{width:300px;height:80px;margin-bottom:30px}"],data:{animation:[v.X]}}),o})()}];let B=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[d.Bz.forChild(z)],d.Bz]}),o})(),j=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[l.ez,B,_.q,s.UX]]}),o})()}}]);